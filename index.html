<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Daily Tasks</title>

<style>
body{
  background:#0b0b0b;
  color:white;
  font-family:-apple-system, BlinkMacSystemFont, system-ui;
  text-align:center;
  padding:30px 16px;
  overflow:hidden;
}

h1{
  font-size:32px;
  margin-bottom:26px;
}

/* BUTTON BASE */
button{
  width:100%;
  max-width:420px;
  min-height:90px;
  margin:14px auto;
  font-size:26px;
  font-weight:700;
  border-radius:22px;
  border:none;
  display:block;
  cursor:pointer;
  transition:0.2s ease;
}

button:active{
  transform:scale(0.95);
}

/* OFF */
.off{
  background:#1f1f1f;
  color:white;
}

/* ON COLORS */
.workout.on{ background:#22c55e; color:black; }
.study.on{ background:#3b82f6; color:white; }
.reading.on{ background:#facc15; color:black; }
.test.on{ background:#ef4444; color:white; }
.mock.on{ background:#f97316; color:white; }

/* PULSE */
@keyframes pulse {
  0%{transform:scale(1);}
  50%{transform:scale(1.08);}
  100%{transform:scale(1);}
}
.pulse{ animation:pulse 0.25s ease; }

/* CONFETTI */
.confetti{
  position:fixed;
  width:10px;
  height:10px;
  top:-10px;
  animation:fall 1.2s linear forwards;
  z-index:9999;
}
@keyframes fall{
  to{
    transform:translateY(120vh) rotate(720deg);
    opacity:0;
  }
}
</style>
</head>

<body>

<h1>Today's Tasks</h1>
<div id="buttons"></div>

<script>

const tasks=["workout","study","reading","test","mock"];

let state={
  workout:false,
  study:false,
  reading:false,
  test:false,
  mock:false
};

// LOAD SAVED STATE
fetch("/state.json",{cache:"no-store"})
  .then(r=>r.json())
  .then(data=>{
    state=data;
    render();
  })
  .catch(()=>render());

// SAVE STATE
function saveState(){
  fetch("/api/save",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify(state)
  });
}

// CONFETTI
function popConfetti(amount=25){
  for(let i=0;i<amount;i++){
    const c=document.createElement("div");
    c.className="confetti";
    c.style.left=Math.random()*100+"vw";
    c.style.background=`hsl(${Math.random()*360},100%,60%)`;
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),1500);
  }
}

// RENDER
function render(){
  const root=document.getElementById("buttons");
  root.innerHTML="";

  tasks.forEach(task=>{
    const btn=document.createElement("button");
    btn.textContent=task.toUpperCase();
    btn.className=`${task} ${state[task]?"on":"off"}`;

    btn.onclick=()=>{
      state[task]=!state[task];
      btn.className=`${task} ${state[task]?"on":"off"}`;

      btn.classList.add("pulse");
      setTimeout(()=>btn.classList.remove("pulse"),250);

      popConfetti(25);
      saveState();
    };

    root.appendChild(btn);
  });
}

render();

</script>

</body>
</html>
