<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Daily Tasks</title>

<style>
body{
  background:#0b0b0b;
  color:white;
  font-family:-apple-system, BlinkMacSystemFont, system-ui;
  text-align:center;
  padding:30px 16px;
}

h1{
  font-size:32px;
  margin-bottom:26px;
}

/* BUTTON BASE */
button{
  width:100%;
  max-width:420px;
  min-height:90px;
  margin:14px auto;
  font-size:26px;
  font-weight:700;
  border-radius:22px;
  border:none;
  display:block;
  cursor:pointer;
  transition:0.2s ease;
}

button:active{
  transform:scale(0.95);
}

/* OFF */
.off{
  background:#1f1f1f;
  color:white;
}

/* ON COLORS */
.workout.on{ background:#22c55e; color:black; }
.study.on{ background:#3b82f6; color:white; }
.reading.on{ background:#facc15; color:black; }
.test.on{ background:#ef4444; color:white; }
.mock.on{ background:#f97316; color:white; }

/* PULSE */
@keyframes pulse {
  0%{transform:scale(1);}
  50%{transform:scale(1.08);}
  100%{transform:scale(1);}
}
.pulse{ animation:pulse 0.25s ease; }

/* CONFETTI */
.confetti{
  position:fixed;
  width:10px;
  height:10px;
  top:-10px;
  animation:fall 1.2s linear forwards;
  z-index:9999;
}
@keyframes fall{
  to{
    transform:translateY(120vh) rotate(720deg);
    opacity:0;
  }
}
</style>
</head>

<body>

<h1>Today's Tasks</h1>
<div id="buttons"></div>

<script>

/* ---------------- TASK LIST ---------------- */

const tasks = ["workout","study","reading","test","mock"];

/* ---------------- LOAD LOCAL STATE ---------------- */

let state = JSON.parse(localStorage.getItem("dailyState")) || {
  workout:false,
  study:false,
  reading:false,
  test:false,
  mock:false
};

/* ---------------- SAVE LOCAL ---------------- */

function saveLocal(){
  localStorage.setItem("dailyState", JSON.stringify(state));
}

/* ---------------- BUILD WALLPAPER NAME ---------------- */

function getWallpaperName(){
  const order=["workout","study","reading","test","mock"];
  const done = order.filter(t=>state[t]);

  if(done.length===0) return "none_done.png";
  if(done.length===5) return "all_done.png";

  return done.join("_")+"_done.png";
}

/* ---------------- SAVE TO SERVER ---------------- */

function saveToServer(filename){
  fetch("/api/save",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ file: filename })
  });
}

/* ---------------- CONFETTI ---------------- */

function popConfetti(amount=25){
  for(let i=0;i<amount;i++){
    const c=document.createElement("div");
    c.className="confetti";
    c.style.left=Math.random()*100+"vw";
    c.style.background=`hsl(${Math.random()*360},100%,60%)`;
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),1500);
  }
}

/* ---------------- RENDER ---------------- */

function render(){
  const root=document.getElementById("buttons");
  root.innerHTML="";

  tasks.forEach(task=>{
    const btn=document.createElement("button");
    btn.textContent=task.toUpperCase();
    btn.className=`${task} ${state[task]?"on":"off"}`;

    btn.onclick=()=>{
      state[task]=!state[task];

      saveLocal();

      const wallpaper = getWallpaperName();
      saveToServer(wallpaper);

      btn.className=`${task} ${state[task]?"on":"off"}`;
      btn.classList.add("pulse");
      setTimeout(()=>btn.classList.remove("pulse"),250);
      popConfetti(25);
    };

    root.appendChild(btn);
  });
}

/* ---------------- INITIALIZE ---------------- */

render();
saveToServer(getWallpaperName());

/* ---------------- AUTO RESET AFTER 6AM ---------------- */

const lastReset = localStorage.getItem("lastReset");
const now = new Date();

if(!lastReset || new Date(lastReset).toDateString() !== now.toDateString()){
  if(now.getHours() >= 6){
    localStorage.removeItem("dailyState");
    localStorage.setItem("lastReset", now.toISOString());
    location.reload();
  }
}

</script>

</body>
</html>
